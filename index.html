<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>112 MÃ¼dahale AlgoritmalarÄ±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="description" content="Hastane Ã¶ncesi acil mÃ¼dahale algoritmalarÄ± â€” hÄ±zlÄ± referans, dozlar ve uyarÄ±lar.">
  <meta name="theme-color" content="#b91c1c">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="112 Asistan">
  <!-- Favicon (PNG for better compatibility) -->
  <link rel="icon" type="image/png" sizes="16x16" href="img/logo.png">
  <link rel="icon" type="image/png" sizes="32x32" href="img/logo.png">
  <link rel="icon" type="image/png" sizes="48x48" href="img/logo.png">
  <link rel="shortcut icon" href="img/logo.png">
  
  <!-- Apple Touch Icons (PNG for iOS compatibility) -->
  <link rel="apple-touch-icon" href="img/logo.png?v=5">
  <link rel="apple-touch-icon" sizes="57x57" href="img/logo.png?v=5">
  <link rel="apple-touch-icon" sizes="60x60" href="img/logo.png?v=5">
  <link rel="apple-touch-icon" sizes="72x72" href="img/logo.png?v=5">
  <link rel="apple-touch-icon" sizes="76x76" href="img/logo.png?v=5">
  <link rel="apple-touch-icon" sizes="114x114" href="img/logo.png?v=5">
  <link rel="apple-touch-icon" sizes="120x120" href="img/logo.png?v=5">
  <link rel="apple-touch-icon" sizes="144x144" href="img/logo.png?v=5">
  <link rel="apple-touch-icon" sizes="152x152" href="img/logo.png?v=5">
  <link rel="apple-touch-icon" sizes="180x180" href="img/logo.png?v=5">
  
  <!-- Microsoft Tiles -->
  <meta name="msapplication-TileImage" content="img/icons/pwa/icon-144x144.jpg">
  <meta name="msapplication-TileColor" content="#b91c1c">
  <meta name="msapplication-config" content="browserconfig.xml">
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="style.css?v=gradient-effects-v1">
  <style>
    /* Modern Nokta Animasyonu */
    .loader-dots { display: flex; justify-content: center; gap: 8px; }
    .loader-dots span { width: 12px; height: 12px; background: #b91c1c; border-radius: 50%; animation: dots 1.4s infinite ease-in-out both; }
    .loader-dots span:nth-child(1) { animation-delay: -0.32s; }
    .loader-dots span:nth-child(2) { animation-delay: -0.16s; }

    @keyframes dots {
        0%, 80%, 100% { transform: scale(0); }
        40% { transform: scale(1.0); }
    }
  </style>
</head>
<body>
<div id="splash-screen" onclick="closeSplashScreen()" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #ffffff; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1); overflow: hidden; cursor: pointer;" title="TÄ±klayarak geÃ§">
    
    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: url('https://www.transparenttextures.com/patterns/pinstriped-suit.png'); opacity: 0.05;"></div>

    <div style="position: relative; z-index: 10; text-align: center;">
        <div style="width: 160px; height: 160px; margin: 0 auto 25px auto; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 15px 35px rgba(185, 28, 28, 0.15); border: 2px solid #f8fafc; overflow: hidden;">
            <img src="img/logo.jpg" 
                 style="width: 130px; height: auto;" 
                 alt="T.C. SaÄŸlÄ±k BakanlÄ±ÄŸÄ±">
        </div>

        <h1 style="color: #b91c1c; font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; font-weight: 900; letter-spacing: 4px; margin: 0; font-size: 32px; text-shadow: 0 2px 4px rgba(0,0,0,0.05);">KIRKLARELÄ° 112</h1>
        <div style="width: 60px; height: 4px; background: #b91c1c; margin: 15px auto; border-radius: 2px;"></div>
        <p style="color: #64748b; font-family: sans-serif; font-weight: 700; font-size: 13px; text-transform: uppercase; letter-spacing: 2px;">Acil SaÄŸlÄ±k EÄŸitim AsistanÄ±</p>

        <div style="margin-top: 50px;">
            <div class="loader-dots">
                <span></span><span></span><span></span>
            </div>
        </div>
    </div>
    
    <div style="position: absolute; bottom: 40px; color: #94a3b8; font-size: 11px; font-family: sans-serif; letter-spacing: 1px; font-weight: 600;">
        T.C. SAÄLIK BAKANLIÄI KURUMSAL REHBERÄ°
    </div>
    
    <div style="position: absolute; bottom: 20px; color: #94a3b8; font-size: 12px; font-family: sans-serif;">
        Â© 2026 Hastane Ã–ncesi BakÄ±m KÄ±lavuzu
    </div>
</div>

<!-- Hero Section - Profesyonel & Modern -->
<div style="position: relative; margin: -16px -16px 30px -16px; padding: 50px 20px 35px; background: linear-gradient(135deg, #1e293b 0%, #334155 100%); overflow: hidden;">
  
  <!-- Subtle Pattern Overlay -->
  <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: radial-gradient(circle at 2px 2px, rgba(255,255,255,0.05) 1px, transparent 0); background-size: 40px 40px; opacity: 0.3;"></div>
  
  <!-- Ambulans IÅŸÄ±ÄŸÄ± Efekti - Daha Subtle -->
  <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;">
    <!-- Sol kÄ±rmÄ±zÄ± Ä±ÅŸÄ±k - daha hafif -->
    <div style="position: absolute; top: 15px; left: 15px; width: 80px; height: 80px; background: radial-gradient(circle, rgba(220, 38, 38, 0.3) 0%, transparent 70%); border-radius: 50%; animation: emergencyLightLeft 2s ease-in-out infinite;"></div>
    <!-- SaÄŸ mavi Ä±ÅŸÄ±k - daha hafif -->
    <div style="position: absolute; top: 15px; right: 15px; width: 80px; height: 80px; background: radial-gradient(circle, rgba(59, 130, 246, 0.3) 0%, transparent 70%); border-radius: 50%; animation: emergencyLightRight 2s ease-in-out infinite;"></div>
  </div>
  
  <!-- Accent Line - KÄ±rmÄ±zÄ± vurgu -->
  <div style="position: absolute; bottom: 0; left: 0; width: 100%; height: 4px; background: linear-gradient(90deg, #dc2626 0%, #ef4444 50%, #dc2626 100%); animation: accentPulse 3s ease-in-out infinite;"></div>
  
  <!-- Content -->
  <div style="position: relative; z-index: 10; text-align: center; color: white;">
    
    <!-- Logo Badge - Daha Kompakt -->
    <div style="display: inline-flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); padding: 10px 20px; border-radius: 50px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.2);">
      <div style="width: 36px; height: 36px; background: linear-gradient(135deg, #dc2626, #b91c1c); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4);">ğŸš‘</div>
      <div style="text-align: left; line-height: 1.2;">
        <div style="font-size: 13px; font-weight: 800; letter-spacing: 1px;">112 ACÄ°L</div>
        <div style="font-size: 9px; opacity: 0.8; font-weight: 600;">KIRKLARELI</div>
      </div>
    </div>
    
    <!-- Main Title - Daha Okunabilir -->
    <h1 style="font-size: 38px; font-weight: 800; margin: 0 0 12px 0; letter-spacing: -0.5px; line-height: 1.2;">
      Acil MÃ¼dahale AsistanÄ±
    </h1>
    
    <!-- Subtitle -->
    <p style="font-size: 15px; opacity: 0.85; margin: 0 0 25px 0; font-weight: 400; max-width: 380px; margin-left: auto; margin-right: auto; line-height: 1.5;">
      Hastane Ã¶ncesi acil bakÄ±m protokollerine<br>hÄ±zlÄ± ve gÃ¼venli eriÅŸim
    </p>
    
    <!-- Stats Cards - Daha Minimal -->
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; max-width: 450px; margin: 0 auto 20px;">
      <div style="background: rgba(255,255,255,0.08); backdrop-filter: blur(10px); padding: 16px 8px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.12)'" onmouseout="this.style.background='rgba(255,255,255,0.08)'">
        <div style="font-size: 32px; font-weight: 900; margin-bottom: 4px;">80+</div>
        <div style="font-size: 10px; opacity: 0.8; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Algoritma</div>
      </div>
      <div style="background: rgba(255,255,255,0.08); backdrop-filter: blur(10px); padding: 16px 8px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.12)'" onmouseout="this.style.background='rgba(255,255,255,0.08)'">
        <div style="font-size: 32px; font-weight: 900; margin-bottom: 4px;">300+</div>
        <div style="font-size: 10px; opacity: 0.8; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Quiz</div>
      </div>
      <div style="background: rgba(255,255,255,0.08); backdrop-filter: blur(10px); padding: 16px 8px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.12)'" onmouseout="this.style.background='rgba(255,255,255,0.08)'">
        <div style="font-size: 32px; font-weight: 900; margin-bottom: 4px;">ğŸ’¯</div>
        <div style="font-size: 10px; opacity: 0.8; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Offline</div>
      </div>
    </div>
    
    <!-- Quick Action Button - Daha Subtle -->
    <button onclick="document.getElementById('searchInput').focus()" style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); color: white; padding: 12px 28px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.2); font-size: 14px; font-weight: 600; box-shadow: 0 4px 12px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.25)'; this.style.transform='translateY(-2px)'" onmouseout="this.style.background='rgba(255,255,255,0.15)'; this.style.transform='translateY(0)'">
      ğŸ” HÄ±zlÄ± Arama
    </button>
    
  </div>
  
  <!-- Theme Toggle - Floating -->
  <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" aria-label="Tema DeÄŸiÅŸtir" title="KaranlÄ±k/AÃ§Ä±k Tema" style="position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); width: 44px; height: 44px;">
    ğŸŒ™
  </button>
  
  <!-- Voice Command Button - Floating -->
  <button id="voiceBtn" onclick="toggleVoiceCommand()" aria-label="Sesli Komut" title="Sesli Komut (Mikrofon)" style="position: absolute; top: 15px; right: 70px; background: rgba(220, 38, 38, 0.15); backdrop-filter: blur(10px); border: 1px solid rgba(220, 38, 38, 0.3); width: 44px; height: 44px; color: white; font-size: 20px; border-radius: 50%; cursor: pointer; transition: all 0.3s ease;">
    ğŸ¤
  </button>
  
  <!-- Location Button - Floating -->
  <button id="locationBtn" onclick="getLocation()" aria-label="Konum Bul" title="Konumumu Bul (GPS)" style="position: absolute; top: 15px; right: 125px; background: rgba(16, 185, 129, 0.15); backdrop-filter: blur(10px); border: 1px solid rgba(16, 185, 129, 0.3); width: 44px; height: 44px; color: white; font-size: 20px; border-radius: 50%; cursor: pointer; transition: all 0.3s ease;">
    ğŸ“
  </button>
  
  <!-- Translation Button - Floating -->
  <button id="translateBtn" onclick="openTranslator()" aria-label="Ã‡eviri" title="Acil Durum Ã‡evirisi" style="position: absolute; top: 15px; right: 180px; background: rgba(59, 130, 246, 0.15); backdrop-filter: blur(10px); border: 1px solid rgba(59, 130, 246, 0.3); width: 44px; height: 44px; color: white; font-size: 20px; border-radius: 50%; cursor: pointer; transition: all 0.3s ease;">
    ğŸŒ
  </button>
  
</div>

<!-- Animasyonlar -->
<style>
@keyframes emergencyLightLeft {
  0%, 100% { 
    opacity: 0.3; 
    transform: scale(1);
  }
  50% { 
    opacity: 0.6; 
    transform: scale(1.1);
  }
}

@keyframes emergencyLightRight {
  0%, 100% { 
    opacity: 0.6; 
    transform: scale(1.1);
  }
  50% { 
    opacity: 0.3; 
    transform: scale(1);
  }
}

@keyframes accentPulse {
  0%, 100% { 
    opacity: 0.6;
  }
  50% { 
    opacity: 1;
  }
}
</style>

<label for="searchInput" class="visually-hidden">Algoritma ara</label>
<div style="position: relative; margin-bottom: 30px;">
  <div style="position: absolute; left: 18px; top: 50%; transform: translateY(-50%); font-size: 20px; pointer-events: none;">ğŸ”</div>
  <input
    type="text"
    id="searchInput"
    placeholder="Algoritma, ilaÃ§ veya prosedÃ¼r ara..."
    onkeyup="searchAlgo()"
    oninput="searchAlgo()"
    aria-label="Algoritma ara"
    style="padding-left: 55px; font-size: 15px; height: 56px;"
  />
  <div style="position: absolute; right: 18px; top: 50%; transform: translateY(-50%); font-size: 11px; color: var(--muted); background: var(--input-bg); padding: 4px 8px; border-radius: 6px; border: 1px solid #e5e7eb;">
    Ctrl+K
  </div>
</div>

<!-- Favoriler BÃ¶lÃ¼mÃ¼ -->
<div id="favoritesSection" style="display: none;">
  <h2 style="margin: 0 0 10px 0; font-size: 1.2rem; color: var(--warning);">â­ Favorilerim</h2>
  <div id="favoritesGrid"></div>
  <p id="noFavorites" style="text-align: center; color: var(--muted); display: none;">HenÃ¼z favori eklenmemiÅŸ. Algoritmalara â­ butonu ile ekleyebilirsiniz.</p>
</div>

<!-- Ana MenÃ¼ - Yeni TasarÄ±m -->
<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 30px;">
  
  <!-- YetiÅŸkin -->
  <div onclick="showGroup('yetiskin')" style="background: linear-gradient(135deg, #3b82f6, #2563eb); padding: 24px; border-radius: 20px; cursor: pointer; position: relative; overflow: hidden; box-shadow: 0 8px 24px rgba(59, 130, 246, 0.25); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-4px) scale(1.02)'" onmouseout="this.style.transform='translateY(0) scale(1)'">
    <div style="position: absolute; top: -20px; right: -20px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
    <div style="position: relative; z-index: 1; color: white;">
      <div style="font-size: 40px; margin-bottom: 10px;">ğŸ§‘</div>
      <div style="font-size: 18px; font-weight: 700; margin-bottom: 5px;">YetiÅŸkin</div>
      <div style="font-size: 12px; opacity: 0.9;">22 Algoritma</div>
    </div>
  </div>
  
  <!-- Ã‡ocuk -->
  <div onclick="showGroup('cocuk')" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); padding: 24px; border-radius: 20px; cursor: pointer; position: relative; overflow: hidden; box-shadow: 0 8px 24px rgba(139, 92, 246, 0.25); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-4px) scale(1.02)'" onmouseout="this.style.transform='translateY(0) scale(1)'">
    <div style="position: absolute; top: -20px; right: -20px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
    <div style="position: relative; z-index: 1; color: white;">
      <div style="font-size: 40px; margin-bottom: 10px;">ğŸ‘¶</div>
      <div style="font-size: 18px; font-weight: 700; margin-bottom: 5px;">Ã‡ocuk</div>
      <div style="font-size: 12px; opacity: 0.9;">20 Algoritma</div>
    </div>
  </div>
  
  <!-- Doz Hesaplama -->
  <div onclick="showChildCalc()" style="background: linear-gradient(135deg, #10b981, #059669); padding: 24px; border-radius: 20px; cursor: pointer; position: relative; overflow: hidden; box-shadow: 0 8px 24px rgba(16, 185, 129, 0.25); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-4px) scale(1.02)'" onmouseout="this.style.transform='translateY(0) scale(1)'">
    <div style="position: absolute; top: -20px; right: -20px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
    <div style="position: relative; z-index: 1; color: white;">
      <div style="font-size: 40px; margin-bottom: 10px;">ğŸ’‰</div>
      <div style="font-size: 18px; font-weight: 700; margin-bottom: 5px;">Doz Hesaplama</div>
      <div style="font-size: 12px; opacity: 0.9;">Ã‡ocuk Ä°laÃ§larÄ±</div>
    </div>
  </div>
  
  <!-- Ä°laÃ§lar -->
  <div onclick="showGroup('ilaclar')" style="background: linear-gradient(135deg, #f59e0b, #d97706); padding: 24px; border-radius: 20px; cursor: pointer; position: relative; overflow: hidden; box-shadow: 0 8px 24px rgba(245, 158, 11, 0.25); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-4px) scale(1.02)'" onmouseout="this.style.transform='translateY(0) scale(1)'">
    <div style="position: absolute; top: -20px; right: -20px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
    <div style="position: relative; z-index: 1; color: white;">
      <div style="font-size: 40px; margin-bottom: 10px;">ğŸ’Š</div>
      <div style="font-size: 18px; font-weight: 700; margin-bottom: 5px;">Ä°laÃ§lar</div>
      <div style="font-size: 12px; opacity: 0.9;">HazÄ±rlama Tablosu</div>
    </div>
  </div>
  
</div>

<!-- Ä°kinci SatÄ±r - KÃ¼Ã§Ã¼k Butonlar -->
<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 30px;">
  
  <!-- Uygulamalar -->
  <button onclick="showProcedures()" style="background: linear-gradient(135deg, #64748b, #475569); padding: 18px; border-radius: 16px; color: white; display: flex; align-items: center; gap: 12px; justify-content: center; font-size: 15px; font-weight: 600;">
    <span style="font-size: 24px;">âš™ï¸</span>
    <span>Uygulamalar</span>
  </button>
  
  <!-- Quiz -->
  <button onclick="showQuizGame()" style="background: linear-gradient(135deg, #ec4899, #db2777); padding: 18px; border-radius: 16px; color: white; display: flex; align-items: center; gap: 12px; justify-content: center; font-size: 15px; font-weight: 600; position: relative;">
    <span style="font-size: 24px;">ğŸ®</span>
    <span>Quiz Oyunu</span>
    <span style="position: absolute; top: 8px; right: 8px; background: rgba(255,255,255,0.3); padding: 2px 8px; border-radius: 10px; font-size: 10px;">300+</span>
  </button>
  
</div>

<!-- YETÄ°ÅKÄ°N -->
<div id="yetiskin" class="section" style="display:none;">
  <h2 id="yetiskinTitle">YetiÅŸkin Ã–n TanÄ±lar</h2>
  
  <div id="yetiskinCategoryMenu" class="grid">
    <button onclick="filterYetiskin('cardiac', 'ğŸ«€ Kardiyak Aciller')" style="background: #fee2e2; color: #b91c1c; border: 2px solid #ef4444; position: relative;">
      ğŸ«€ Kardiyak
      <span style="position: absolute; top: 8px; right: 8px; background: #dc2626; color: white; font-size: 11px; padding: 3px 8px; border-radius: 12px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">7</span>
    </button>
    <button onclick="filterYetiskin('respiratory', 'ğŸ« Solunum Aciller')" style="background: #ecfdf5; color: #059669; border: 2px solid #10b981; position: relative;">
      ğŸ« Solunum
      <span style="position: absolute; top: 8px; right: 8px; background: #059669; color: white; font-size: 11px; padding: 3px 8px; border-radius: 12px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">2</span>
    </button>
    <button onclick="filterYetiskin('neuro', 'ğŸ§  NÃ¶rolojik Aciller')" style="background: #eef2ff; color: #4f46e5; border: 2px solid #6366f1; position: relative;">
      ğŸ§  NÃ¶rolojik
      <span style="position: absolute; top: 8px; right: 8px; background: #4f46e5; color: white; font-size: 11px; padding: 3px 8px; border-radius: 12px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">4</span>
    </button>
    <button onclick="filterYetiskin('other', 'ğŸš‘ DiÄŸer Aciller')" style="background: #fffbeb; color: #d97706; border: 2px solid #f59e0b; position: relative;">
      ğŸš‘ DiÄŸer
      <span style="position: absolute; top: 8px; right: 8px; background: #d97706; color: white; font-size: 11px; padding: 3px 8px; border-radius: 12px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">9</span>
    </button>
  </div>

  <div id="yetiskinGrid" class="grid" style="display:none; margin-top: 20px;">
    <button class="back-btn" style="grid-column: 1 / -1; background: #4b5563; margin-bottom:10px;" onclick="resetYetiskinView()">â¬…ï¸ Kategorilere DÃ¶n</button>
    
    <button data-key="aks" data-category="cardiac" data-tags="kalp,stemi,ekg,aspirin" onclick="showAlgo('aks','YetiÅŸkin')">AKS</button>
    <button data-key="bradikardi" data-category="cardiac" data-tags="yavas,nabiz,atropin" onclick="showAlgo('bradikardi','YetiÅŸkin')">Bradikardi</button>
    <button data-key="tasikardi" data-category="cardiac" data-tags="hizli,nabiz,adenozin" onclick="showAlgo('tasikardi','YetiÅŸkin')">TaÅŸikardi</button>
    <button data-key="arrest" data-category="cardiac" data-tags="kpr,defib,adrenalin" onclick="showAlgo('arrest','YetiÅŸkin')">Arrest</button>
    <button data-key="kardiyojenik_sok_y" data-category="cardiac" data-tags="kalp,ÅŸok,eriÅŸkin,yetmezlik,mi" onclick="showAlgo('kardiyojenik_sok_y','YetiÅŸkin')">ğŸ«€ Kardiyojenik Åok</button>
    <button data-key="post_rosc_y" data-category="cardiac" data-tags="kpr,rosc,eriÅŸkin,kalp,arrest" onclick="showAlgo('post_rosc_y','YetiÅŸkin')">ğŸ¥ Post-ROSC BakÄ±m</button>
    <button data-key="hipotermi_arrest" data-category="cardiac" data-tags="arrest,soÄŸuk,hipotermi,eriÅŸkin" onclick="showAlgo('hipotermi_arrest','YetiÅŸkin')">â„ï¸ Hipotermik Arrest</button>

    <button data-key="astim" data-category="respiratory" data-tags="nefes,bronkospazm,ventolin" onclick="showAlgo('astim','YetiÅŸkin')">AstÄ±m</button>
    <button data-key="koah" data-category="respiratory" data-tags="koah,nefes,hiperkapni" onclick="showAlgo('koah','YetiÅŸkin')">KOAH</button>

    <button data-key="inme" data-category="neuro" data-tags="felÃ§,inme,fast,yÃ¼z" onclick="showAlgo('inme','YetiÅŸkin')">Ä°nme (SVH)</button>
    <button data-key="nobet" data-category="neuro" data-tags="nÃ¶bet,konvÃ¼lziyon,midazolam" onclick="showAlgo('nobet','YetiÅŸkin')">NÃ¶bet</button>
    <button data-key="kafa" data-category="neuro" data-tags="kafa,gks,entÃ¼basyon" onclick="showAlgo('kafa','YetiÅŸkin')">Kafa TravmasÄ±</button>
    <button data-key="vertigo" data-category="neuro" data-tags="baÅŸdÃ¶nmesi,bulantÄ±" onclick="showAlgo('vertigo','YetiÅŸkin')">Vertigo</button>

    <button data-key="gebe_hipertansiyon" data-category="other" data-tags="gebe,eklampsi,tansiyon" onclick="showAlgo('gebe_hipertansiyon','YetiÅŸkin')">ğŸ¤° Gebe HT / Eklampsi</button>
    <button data-key="dogum" data-category="other" data-tags="gebe,bebek,plasenta,kanama" onclick="showAlgo('dogum','YetiÅŸkin')">Acil DoÄŸum</button>
    <button data-key="hipoglisemi" data-category="other" data-tags="ÅŸeker,diyabet,komo,kan ÅŸekeri" onclick="showAlgo('hipoglisemi','YetiÅŸkin')">Hipoglisemi</button>
    <button data-key="hipovolemi" data-category="other" data-tags="ÅŸok,sÄ±vÄ±,kanama" onclick="showAlgo('hipovolemi','YetiÅŸkin')">Hipovolemik Åok</button>
    <button data-key="yanik" data-category="other" data-tags="yanÄ±k,parkland,alan" onclick="showAlgo('yanik','YetiÅŸkin')">YanÄ±k</button>
    <button data-key="zehir" data-category="other" data-tags="zehir,toksikoloji,antidot" onclick="showAlgo('zehir','YetiÅŸkin')">Zehirlenme</button>
    <button data-key="anafilaksi" data-category="other" data-tags="alerji,ÅŸok,epinefrin" onclick="showAlgo('anafilaksi','YetiÅŸkin')">Anafilaksi</button>
    <button data-key="travma" data-category="other" data-tags="travma,immobilizasyon,kanama" onclick="showAlgo('travma','YetiÅŸkin')">TravmalÄ± Hasta</button>
    <button data-key="crush" data-category="other" data-tags="crush,myoglobin,hiperkalemi" onclick="showAlgo('crush','YetiÅŸkin')">Crush Sendromu</button>
</div>
</div>

<div id="cocuk" class="section" style="display:none;">
    <h2 id="cocukTitle">Ã‡ocuk Ã–n TanÄ±lar</h2>
    
    <div id="cocukCategoryMenu" class="grid">
        <button onclick="filterCocuk('cardiac', 'ğŸ«€ Ã‡ocuk Kardiyak')" style="background: #fee2e2; color: #b91c1c; border: 2px solid #ef4444; position: relative;">
          ğŸ«€ Kardiyak
          <span style="position: absolute; top: 8px; right: 8px; background: #dc2626; color: white; font-size: 11px; padding: 3px 8px; border-radius: 12px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">6</span>
        </button>
        <button onclick="filterCocuk('respiratory', 'ğŸ« Ã‡ocuk Solunum')" style="background: #ecfdf5; color: #059669; border: 2px solid #10b981; position: relative;">
          ğŸ« Solunum
          <span style="position: absolute; top: 8px; right: 8px; background: #059669; color: white; font-size: 11px; padding: 3px 8px; border-radius: 12px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">3</span>
        </button>
        <button onclick="filterCocuk('neuro', 'ğŸ§  Ã‡ocuk NÃ¶roloji')" style="background: #eef2ff; color: #4f46e5; border: 2px solid #6366f1; position: relative;">
          ğŸ§  NÃ¶rolojik
          <span style="position: absolute; top: 8px; right: 8px; background: #4f46e5; color: white; font-size: 11px; padding: 3px 8px; border-radius: 12px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">3</span>
        </button>
        <button onclick="filterCocuk('other', 'ğŸš‘ Ã‡ocuk DiÄŸer')" style="background: #fffbeb; color: #d97706; border: 2px solid #f59e0b; position: relative;">
          ğŸš‘ DiÄŸer
          <span style="position: absolute; top: 8px; right: 8px; background: #d97706; color: white; font-size: 11px; padding: 3px 8px; border-radius: 12px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">8</span>
        </button>
    </div>

    <div id="cocukGrid" class="grid" style="display:none; margin-top: 20px;">
        <button class="back-btn" style="grid-column: 1 / -1; background: #4b5563; margin-bottom:10px;" onclick="resetCocukView()">â¬…ï¸ Kategorilere DÃ¶n</button>
        
        <button data-key="arrest" data-category="cardiac" data-tags="kpr,Ã§ocuk,defib" onclick="showAlgo('arrest','Ã‡ocuk')">Arrest</button>
        <button data-key="bradikardi" data-category="cardiac" data-tags="yavas,Ã§ocuk,atropin" onclick="showAlgo('bradikardi','Ã‡ocuk')">Bradikardi</button>
        <button data-key="tasikardi" data-category="cardiac" data-tags="hÄ±zlÄ±,Ã§ocuk,adenozin" onclick="showAlgo('tasikardi','Ã‡ocuk')">TaÅŸikardi</button>
        <button data-key="kardiyojenik_sok" data-category="cardiac" data-tags="kalp,ÅŸok,Ã§ocuk" onclick="showAlgo('kardiyojenik_sok','Ã‡ocuk')">ğŸ«€ Kardiyojenik Åok</button>
        <button data-key="post_rosc_cocuk" data-category="cardiac" onclick="showAlgo('post_rosc_cocuk','Ã‡ocuk')">ğŸ”„ Post-ROSC BakÄ±m</button>
        <button data-key="nrp" data-category="cardiac" data-tags="yenidoÄŸan,bebek,nrp" onclick="showAlgo('nrp','Ã‡ocuk')">NRP (YenidoÄŸan)</button>

        <button data-key="astim" data-category="respiratory" data-tags="nefes,Ã§ocuk,ventolin" onclick="showAlgo('astim','Ã‡ocuk')">AstÄ±m</button>
        <button data-key="krup" data-category="respiratory" data-tags="stridor,Ã§ocuk" onclick="showAlgo('krup','Ã‡ocuk')">Krup</button>
        <button data-key="epiglotit_cocuk" data-category="respiratory" onclick="showAlgo('epiglotit_cocuk','Ã‡ocuk')">Epiglotit</button>

        <button data-key="nobet" data-category="neuro" data-tags="nÃ¶bet,Ã§ocuk" onclick="showAlgo('nobet','Ã‡ocuk')">NÃ¶bet</button>
        <button data-key="kafa" data-category="neuro" data-tags="kafa,Ã§ocuk" onclick="showAlgo('kafa','Ã‡ocuk')">Kafa TravmasÄ±</button>
        <button data-key="vertigo" data-category="neuro" onclick="showAlgo('vertigo','Ã‡ocuk')">Vertigo</button>

        <button data-key="ates_cocuk" data-category="other" onclick="showAlgo('ates_cocuk','Ã‡ocuk')">YÃ¼ksek AteÅŸ</button>
        <button data-key="septik_sok_cocuk" data-category="other" onclick="showAlgo('septik_sok_cocuk','Ã‡ocuk')">ğŸ¦  Ã‡ocuk Septik Åok</button>
        <button data-key="p_hipoglisemi" data-category="other" onclick="showAlgo('p_hipoglisemi','Ã‡ocuk')">Hipoglisemi</button>
        <button data-key="anafilaksi" data-category="other" data-tags="alerji,Ã§ocuk" onclick="showAlgo('anafilaksi','Ã‡ocuk')">Anafilaksi</button>
        <button data-key="travma" data-category="other" onclick="showAlgo('travma','Ã‡ocuk')">TravmalÄ± Hasta</button>
        <button data-key="yanik" data-category="other" onclick="showAlgo('yanik','Ã‡ocuk')">YanÄ±k</button>
        <button data-key="zehir" data-category="other" onclick="showAlgo('zehir','Ã‡ocuk')">Zehirlenme</button>
        <button data-key="crush" data-category="other" onclick="showAlgo('crush','Ã‡ocuk')">Crush Sendromu</button>
    </div>
</div>

  <!-- Ã‡OCUK DOZ -->
  </div> <div id="cocukDozSection" class="section" style="display:none;">
  <div style="background:#fff; padding:20px; border-radius:20px; box-shadow:var(--card-shadow);">
    <h2 style="text-align:center;">ğŸ‘¶ Ã‡ocuk Doz Hesaplama</h2>
    <p class="info">Ã‡ocuÄŸun kilosunu girerek kritik ilaÃ§ dozlarÄ±nÄ± anlÄ±k hesaplayÄ±n.</p>
    <label for="kiloInput" class="visually-hidden">Kilo</label>
    <div style="margin-bottom:15px; background:#f8fafc; padding:15px; border-radius:12px; border:1px solid #e2e8f0;">
  <label style="display:block; font-weight:bold; margin-bottom:8px; font-size:14px;">ğŸ“ YaÅŸa GÃ¶re Kilo Tahmin Et (Opsiyonel)</label>
  <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
    <select id="yasTipi" style="padding:10px; border-radius:8px; border:1px solid #cbd5e1;">
      <option value="ay">Ay (0-12)</option>
      <option value="yil" selected>YaÅŸ (1-15)</option>
    </select>
    <input type="number" id="yasDeger" placeholder="DeÄŸer gir..." oninput="tahminiKiloHesapla()" style="padding:10px; border-radius:8px; border:1px solid #cbd5e1;">
  </div>
</div>

<label style="display:block; font-weight:bold; margin-bottom:8px; font-size:14px;">âš–ï¸ Kesin Kilo (kg)</label>
<input type="number" id="kiloInput" placeholder="Kilo (kg) giriniz..." oninput="hesaplaCocukDoz()" aria-label="Kilo (kg)" style="width:100%; padding:14px; border-radius:12px; border:1px solid #ddd; font-size:18px; background:#fff7ed;">
    <div id="dozSonuc" aria-live="polite" style="margin-top:20px;"></div>
  </div>
</div>

<div id="content" aria-live="polite" style="display:none;"></div>

<!-- CPR -->
<div id="ilacTabloSection" class="section" style="display:none;">
    <div style="background:#fff; padding:15px; border-radius:20px; box-shadow:var(--card-shadow); overflow-x: auto; margin-bottom: 20px;">
      <h2 style="text-align:center;">ğŸ’‰ Acil Ä°laÃ§ HazÄ±rlama</h2>
      <table style="width:100%; border-collapse: collapse; font-size: 13px; text-align: left;">
        <thead>
          <tr style="background: var(--primary-1); color: white;">
            <th style="padding: 10px; border: 1px solid #ddd;">Ä°laÃ§ AdÄ±</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Form / Doz</th>
            <th style="padding: 10px; border: 1px solid #ddd;">HazÄ±rlanÄ±ÅŸ / Notlar</th>
          </tr>
        </thead>
        <tbody id="ilacTabloGÃ¶vde">
          </tbody>
      </table>
    </div>
  </div>

  <div id="cprBox">
  <h2>ğŸ«€ CPR SayacÄ±</h2>
  <div id="cprTimer" role="timer" aria-live="polite">02:00</div>
  <div class="cpr-controls">
    <button onclick="startCPR()">â–¶ï¸ BaÅŸlat</button>
    <button onclick="stopCPR()">â¹ Durdur</button>
    <button onclick="resetCPR()">ğŸ” SÄ±fÄ±rla</button>
  </div>
  <p id="cprAlert" aria-live="assertive"></p>

</div>

<script src="app.js?v=koah-removed-v34" defer></script>

<!-- Sesli Komut Sistemi -->
<script>
// Sesli komut deÄŸiÅŸkenleri
let recognition = null;
let isListening = false;

// Web Speech API desteÄŸi kontrolÃ¼
if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRecognition();
  
  recognition.lang = 'tr-TR';
  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;
  
  // Sesli komut baÅŸladÄ±ÄŸÄ±nda
  recognition.onstart = function() {
    isListening = true;
    const voiceBtn = document.getElementById('voiceBtn');
    voiceBtn.style.background = 'rgba(220, 38, 38, 0.8)';
    voiceBtn.style.transform = 'scale(1.1)';
    voiceBtn.innerHTML = 'ğŸ”´';
    
    // Dinleme gÃ¶stergesi
    showVoiceIndicator('Dinliyorum...');
  };
  
  // Sesli komut sonuÃ§landÄ±ÄŸÄ±nda
  recognition.onresult = function(event) {
    const transcript = event.results[0][0].transcript.toLowerCase().trim();
    console.log('AlgÄ±lanan komut:', transcript);
    
    processVoiceCommand(transcript);
  };
  
  // Sesli komut bittiÄŸinde
  recognition.onend = function() {
    isListening = false;
    const voiceBtn = document.getElementById('voiceBtn');
    voiceBtn.style.background = 'rgba(220, 38, 38, 0.15)';
    voiceBtn.style.transform = 'scale(1)';
    voiceBtn.innerHTML = 'ğŸ¤';
    
    hideVoiceIndicator();
  };
  
  // Hata durumunda
  recognition.onerror = function(event) {
    console.error('Ses tanÄ±ma hatasÄ±:', event.error, event);
    isListening = false;
    const voiceBtn = document.getElementById('voiceBtn');
    if (voiceBtn) {
      voiceBtn.style.background = 'rgba(220, 38, 38, 0.15)';
      voiceBtn.style.transform = 'scale(1)';
      voiceBtn.innerHTML = 'ğŸ¤';
    }
    
    let errorMsg = 'Hata oluÅŸtu';
    let showError = true;
    
    if (event.error === 'no-speech') {
      errorMsg = 'Ses algÄ±lanamadÄ±. Tekrar deneyin.';
    } else if (event.error === 'not-allowed' || event.error === 'permission-denied') {
      errorMsg = 'Mikrofon izni gerekli. TarayÄ±cÄ± ayarlarÄ±ndan izin verin.';
    } else if (event.error === 'network') {
      errorMsg = 'Ä°nternet baÄŸlantÄ±sÄ± gerekli';
    } else if (event.error === 'aborted') {
      errorMsg = 'Ses tanÄ±ma iptal edildi';
      showError = false; // Normal durum, hata gÃ¶sterme
    } else if (event.error === 'audio-capture') {
      errorMsg = 'Mikrofon eriÅŸimi baÅŸarÄ±sÄ±z. BaÅŸka uygulama kullanÄ±yor olabilir.';
    } else if (event.error === 'service-not-allowed') {
      errorMsg = 'Ses tanÄ±ma servisi kullanÄ±lamÄ±yor';
    } else {
      errorMsg = `Hata: ${event.error}`;
    }
    
    if (showError) {
      showVoiceIndicator(errorMsg, true);
      setTimeout(hideVoiceIndicator, 3000);
    }
  };
  
  // Ses tanÄ±ma sonlandÄ±ÄŸÄ±nda (mobilde Ã¶nemli)
  recognition.onsoundend = function() {
    console.log('Ses algÄ±lama bitti');
  };
  
  recognition.onspeechend = function() {
    console.log('KonuÅŸma bitti');
  };
  
  recognition.onaudiostart = function() {
    console.log('Ses kaydÄ± baÅŸladÄ±');
  };
  
  recognition.onaudioend = function() {
    console.log('Ses kaydÄ± bitti');
  };
}

// Sesli komutu aÃ§/kapat
function toggleVoiceCommand() {
  if (!recognition) {
    alert('TarayÄ±cÄ±nÄ±z sesli komut Ã¶zelliÄŸini desteklemiyor. Chrome, Safari veya Edge kullanÄ±n.');
    return;
  }
  
  if (isListening) {
    recognition.stop();
  } else {
    try {
      // Mobil iÃ§in Ã¶zel ayarlar
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;
      
      // Mobilde daha iyi Ã§alÄ±ÅŸmasÄ± iÃ§in
      if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        console.log('Mobil cihaz algÄ±landÄ±, Ã¶zel ayarlar uygulanÄ±yor');
        recognition.continuous = false;
      }
      
      recognition.start();
      console.log('Ses tanÄ±ma baÅŸlatÄ±ldÄ±');
    } catch (error) {
      console.error('Ses tanÄ±ma baÅŸlatma hatasÄ±:', error);
      
      let errorMsg = 'Ses tanÄ±ma baÅŸlatÄ±lamadÄ±';
      if (error.message.includes('already started')) {
        errorMsg = 'Ses tanÄ±ma zaten Ã§alÄ±ÅŸÄ±yor';
        recognition.stop();
        setTimeout(() => recognition.start(), 100);
      } else if (error.message.includes('not-allowed')) {
        errorMsg = 'Mikrofon izni gerekli. TarayÄ±cÄ± ayarlarÄ±ndan izin verin.';
      }
      
      showVoiceIndicator(errorMsg, true);
      setTimeout(hideVoiceIndicator, 3000);
    }
  }
}

// Sesli komutu iÅŸle
function processVoiceCommand(command) {
  console.log('Ä°ÅŸlenen komut:', command);
  
  // Komut eÅŸleÅŸtirme
  if (command.includes('yetiÅŸkin')) {
    showVoiceIndicator('YetiÅŸkin menÃ¼sÃ¼ aÃ§Ä±lÄ±yor...', false);
    setTimeout(() => {
      showGroup('yetiskin');
      hideVoiceIndicator();
      
      // Alt komutlarÄ± kontrol et
      if (command.includes('arrest') || command.includes('arest')) {
        setTimeout(() => showAlgo('arrest', 'YetiÅŸkin'), 500);
      } else if (command.includes('bradikardi')) {
        setTimeout(() => showAlgo('bradikardi', 'YetiÅŸkin'), 500);
      } else if (command.includes('taÅŸikardi') || command.includes('tasikardi')) {
        setTimeout(() => showAlgo('tasikardi', 'YetiÅŸkin'), 500);
      } else if (command.includes('astÄ±m') || command.includes('astim')) {
        setTimeout(() => showAlgo('astim', 'YetiÅŸkin'), 500);
      } else if (command.includes('inme')) {
        setTimeout(() => showAlgo('inme', 'YetiÅŸkin'), 500);
      } else if (command.includes('nÃ¶bet') || command.includes('nobet')) {
        setTimeout(() => showAlgo('nobet', 'YetiÅŸkin'), 500);
      }
    }, 500);
  } 
  else if (command.includes('Ã§ocuk') || command.includes('cocuk')) {
    showVoiceIndicator('Ã‡ocuk menÃ¼sÃ¼ aÃ§Ä±lÄ±yor...', false);
    setTimeout(() => {
      showGroup('cocuk');
      hideVoiceIndicator();
      
      // Alt komutlarÄ± kontrol et
      if (command.includes('arrest') || command.includes('arest')) {
        setTimeout(() => showAlgo('arrest', 'Ã‡ocuk'), 500);
      } else if (command.includes('bradikardi')) {
        setTimeout(() => showAlgo('bradikardi', 'Ã‡ocuk'), 500);
      } else if (command.includes('taÅŸikardi') || command.includes('tasikardi')) {
        setTimeout(() => showAlgo('tasikardi', 'Ã‡ocuk'), 500);
      } else if (command.includes('astÄ±m') || command.includes('astim')) {
        setTimeout(() => showAlgo('astim', 'Ã‡ocuk'), 500);
      } else if (command.includes('nÃ¶bet') || command.includes('nobet')) {
        setTimeout(() => showAlgo('nobet', 'Ã‡ocuk'), 500);
      }
    }, 500);
  }
  else if (command.includes('doz') || command.includes('hesaplama')) {
    showVoiceIndicator('Doz hesaplama aÃ§Ä±lÄ±yor...', false);
    setTimeout(() => {
      showChildCalc();
      hideVoiceIndicator();
    }, 500);
  }
  else if (command.includes('ilaÃ§') || command.includes('ilac')) {
    showVoiceIndicator('Ä°laÃ§ tablosu aÃ§Ä±lÄ±yor...', false);
    setTimeout(() => {
      showGroup('ilaclar');
      hideVoiceIndicator();
    }, 500);
  }
  else if (command.includes('quiz') || command.includes('kuiz')) {
    showVoiceIndicator('Quiz aÃ§Ä±lÄ±yor...', false);
    setTimeout(() => {
      showQuizGame();
      hideVoiceIndicator();
    }, 500);
  }
  else if (command.includes('geri') || command.includes('ana sayfa') || command.includes('anasayfa')) {
    showVoiceIndicator('Ana sayfaya dÃ¶nÃ¼lÃ¼yor...', false);
    setTimeout(() => {
      location.reload();
    }, 500);
  }
  else if (command.includes('arama') || command.includes('ara')) {
    showVoiceIndicator('Arama kutusuna odaklanÄ±lÄ±yor...', false);
    setTimeout(() => {
      document.getElementById('searchInput').focus();
      hideVoiceIndicator();
    }, 500);
  }
  else if (command.includes('karanlÄ±k') || command.includes('karanlik') || command.includes('tema')) {
    showVoiceIndicator('Tema deÄŸiÅŸtiriliyor...', false);
    setTimeout(() => {
      toggleTheme();
      hideVoiceIndicator();
    }, 500);
  }
  else {
    showVoiceIndicator('Komut anlaÅŸÄ±lamadÄ±. Tekrar deneyin.', true);
    setTimeout(hideVoiceIndicator, 2000);
  }
}

// Sesli komut gÃ¶stergesi
function showVoiceIndicator(message, isError = false) {
  let indicator = document.getElementById('voiceIndicator');
  
  if (!indicator) {
    indicator = document.createElement('div');
    indicator.id = 'voiceIndicator';
    indicator.style.cssText = `
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: ${isError ? 'rgba(220, 38, 38, 0.95)' : 'rgba(16, 185, 129, 0.95)'};
      color: white;
      padding: 12px 24px;
      border-radius: 50px;
      font-size: 14px;
      font-weight: 600;
      z-index: 10000;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      backdrop-filter: blur(10px);
      animation: slideDown 0.3s ease;
    `;
    document.body.appendChild(indicator);
  }
  
  indicator.textContent = message;
  indicator.style.background = isError ? 'rgba(220, 38, 38, 0.95)' : 'rgba(16, 185, 129, 0.95)';
  indicator.style.display = 'block';
}

function hideVoiceIndicator() {
  const indicator = document.getElementById('voiceIndicator');
  if (indicator) {
    indicator.style.animation = 'slideUp 0.3s ease';
    setTimeout(() => {
      indicator.style.display = 'none';
    }, 300);
  }
}

// Animasyonlar
const style = document.createElement('style');
style.textContent = `
  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateX(-50%) translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
  }
  
  @keyframes slideUp {
    from {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    to {
      opacity: 0;
      transform: translateX(-50%) translateY(-20px);
    }
  }
  
  #voiceBtn:hover {
    transform: scale(1.1) !important;
    background: rgba(220, 38, 38, 0.3) !important;
  }
  
  #voiceBtn:active {
    transform: scale(0.95) !important;
  }
  
  #locationBtn:hover {
    transform: scale(1.1) !important;
    background: rgba(16, 185, 129, 0.3) !important;
  }
  
  #locationBtn:active {
    transform: scale(0.95) !important;
  }
  
  #translateBtn:hover {
    transform: scale(1.1) !important;
    background: rgba(59, 130, 246, 0.3) !important;
  }
  
  #translateBtn:active {
    transform: scale(0.95) !important;
  }
`;
document.head.appendChild(style);

// Klavye kÄ±sayolu: Ctrl+M veya Cmd+M ile sesli komutu aÃ§
document.addEventListener('keydown', function(e) {
  if ((e.ctrlKey || e.metaKey) && e.key === 'm') {
    e.preventDefault();
    toggleVoiceCommand();
  }
  // Ctrl+L ile konum bul
  if ((e.ctrlKey || e.metaKey) && e.key === 'l') {
    e.preventDefault();
    getLocation();
  }
  // Ctrl+T ile Ã§eviri aÃ§
  if ((e.ctrlKey || e.metaKey) && e.key === 't') {
    e.preventDefault();
    openTranslator();
  }
});

// ===== KONUM BULMA SÄ°STEMÄ° =====
let currentLocation = null;

function getLocation() {
  if (!navigator.geolocation) {
    showLocationModal('TarayÄ±cÄ±nÄ±z konum Ã¶zelliÄŸini desteklemiyor.', true);
    return;
  }
  
  // Buton animasyonu
  const locationBtn = document.getElementById('locationBtn');
  locationBtn.style.background = 'rgba(16, 185, 129, 0.8)';
  locationBtn.style.transform = 'scale(1.1)';
  locationBtn.innerHTML = 'ğŸ”„';
  
  showLocationIndicator('Konum alÄ±nÄ±yor...');
  
  navigator.geolocation.getCurrentPosition(
    // BaÅŸarÄ±lÄ±
    function(position) {
      currentLocation = {
        latitude: position.coords.latitude,
        longitude: position.coords.longitude,
        accuracy: position.coords.accuracy,
        timestamp: new Date(position.timestamp)
      };
      
      // Buton normal haline dÃ¶n
      locationBtn.style.background = 'rgba(16, 185, 129, 0.15)';
      locationBtn.style.transform = 'scale(1)';
      locationBtn.innerHTML = 'ğŸ“';
      
      hideLocationIndicator();
      showLocationModal();
    },
    // Hata
    function(error) {
      locationBtn.style.background = 'rgba(16, 185, 129, 0.15)';
      locationBtn.style.transform = 'scale(1)';
      locationBtn.innerHTML = 'ğŸ“';
      
      hideLocationIndicator();
      
      let errorMsg = 'Konum alÄ±namadÄ±.';
      if (error.code === 1) {
        errorMsg = 'Konum izni reddedildi. LÃ¼tfen tarayÄ±cÄ± ayarlarÄ±ndan izin verin.';
      } else if (error.code === 2) {
        errorMsg = 'Konum bilgisi alÄ±namadÄ±. GPS aÃ§Ä±k mÄ± kontrol edin.';
      } else if (error.code === 3) {
        errorMsg = 'Konum alma zaman aÅŸÄ±mÄ±na uÄŸradÄ±. Tekrar deneyin.';
      }
      
      showLocationModal(errorMsg, true);
    },
    // SeÃ§enekler
    {
      enableHighAccuracy: true,
      timeout: 10000,
      maximumAge: 0
    }
  );
}

function showLocationIndicator(message) {
  let indicator = document.getElementById('locationIndicator');
  
  if (!indicator) {
    indicator = document.createElement('div');
    indicator.id = 'locationIndicator';
    indicator.style.cssText = `
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(16, 185, 129, 0.95);
      color: white;
      padding: 12px 24px;
      border-radius: 50px;
      font-size: 14px;
      font-weight: 600;
      z-index: 10000;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      backdrop-filter: blur(10px);
      animation: slideDown 0.3s ease;
    `;
    document.body.appendChild(indicator);
  }
  
  indicator.textContent = message;
  indicator.style.display = 'block';
}

function hideLocationIndicator() {
  const indicator = document.getElementById('locationIndicator');
  if (indicator) {
    indicator.style.animation = 'slideUp 0.3s ease';
    setTimeout(() => {
      indicator.style.display = 'none';
    }, 300);
  }
}

function showLocationModal(errorMessage = null, isError = false) {
  // Modal oluÅŸtur
  let modal = document.getElementById('locationModal');
  
  if (!modal) {
    modal = document.createElement('div');
    modal.id = 'locationModal';
    modal.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      z-index: 10001;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s ease;
    `;
    
    // BoÅŸluÄŸa tÄ±klayÄ±nca kapat
    modal.addEventListener('click', function(e) {
      if (e.target === modal) {
        closeLocationModal();
      }
    });
    
    document.body.appendChild(modal);
  }
  
  if (isError) {
    modal.innerHTML = `
      <div onclick="event.stopPropagation()" style="background: var(--card-bg); padding: 30px; border-radius: 20px; max-width: 400px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.4); animation: scaleIn 0.3s ease;">
        <div style="text-align: center; margin-bottom: 20px;">
          <div style="font-size: 60px; margin-bottom: 15px;">âŒ</div>
          <h2 style="margin: 0 0 10px 0; color: var(--danger);">Hata</h2>
          <p style="color: var(--text); margin: 0; font-size: 15px;">${errorMessage}</p>
        </div>
        <button onclick="closeLocationModal()" style="width: 100%; padding: 14px; background: var(--danger); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer;">
          Kapat
        </button>
      </div>
    `;
  } else {
    const lat = currentLocation.latitude.toFixed(6);
    const lon = currentLocation.longitude.toFixed(6);
    const accuracy = Math.round(currentLocation.accuracy);
    const time = currentLocation.timestamp.toLocaleTimeString('tr-TR');
    
    // Google Maps linki
    const googleMapsLink = `https://www.google.com/maps?q=${lat},${lon}`;
    
    // Koordinat metni
    const coordText = `${lat}, ${lon}`;
    
    modal.innerHTML = `
      <div onclick="event.stopPropagation()" style="background: var(--card-bg); padding: 30px; border-radius: 20px; max-width: 450px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.4); animation: scaleIn 0.3s ease;">
        <div style="text-align: center; margin-bottom: 25px;">
          <div style="font-size: 60px; margin-bottom: 15px;">ğŸ“</div>
          <h2 style="margin: 0 0 10px 0; color: var(--success-1);">Konum Bulundu</h2>
          <p style="color: var(--muted); margin: 0; font-size: 13px;">Hassasiyet: Â±${accuracy} metre â€¢ ${time}</p>
        </div>
        
        <div style="background: var(--input-bg); padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 2px solid var(--success-1);">
          <div style="font-size: 13px; color: var(--muted); margin-bottom: 8px; font-weight: 600;">KOORDÄ°NATLAR</div>
          <div style="font-size: 18px; font-weight: 700; color: var(--text); font-family: monospace; word-break: break-all; line-height: 1.5;">
            ${lat}, ${lon}
          </div>
          <div style="margin-top: 12px; font-size: 12px; color: var(--muted);">
            <div>ğŸ“ Enlem: ${lat}Â°</div>
            <div>ğŸ“ Boylam: ${lon}Â°</div>
          </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
          <button onclick="copyCoordinates('${coordText}')" style="padding: 12px; background: var(--primary-1); color: white; border: none; border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px;">
            ğŸ“‹ Kopyala
          </button>
          <button onclick="shareCoordinates('${coordText}')" style="padding: 12px; background: var(--success-1); color: white; border: none; border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px;">
            ğŸ“¤ PaylaÅŸ
          </button>
        </div>
        
        <button onclick="window.open('${googleMapsLink}', '_blank')" style="width: 100%; padding: 14px; background: linear-gradient(135deg, #4285f4, #34a853); color: white; border: none; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; margin-bottom: 10px;">
          ğŸ—ºï¸ Google Maps'te AÃ§
        </button>
        
        <button onclick="closeLocationModal()" style="width: 100%; padding: 12px; background: var(--input-bg); color: var(--text); border: 1px solid var(--muted); border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer;">
          Kapat
        </button>
      </div>
    `;
  }
  
  modal.style.display = 'flex';
}

function closeLocationModal() {
  const modal = document.getElementById('locationModal');
  if (modal) {
    modal.style.animation = 'fadeOut 0.3s ease';
    setTimeout(() => {
      modal.style.display = 'none';
    }, 300);
  }
}

function copyCoordinates(coords) {
  if (navigator.clipboard) {
    navigator.clipboard.writeText(coords).then(() => {
      showLocationIndicator('Koordinatlar kopyalandÄ±! âœ…');
      setTimeout(hideLocationIndicator, 2000);
    }).catch(() => {
      fallbackCopy(coords);
    });
  } else {
    fallbackCopy(coords);
  }
}

function fallbackCopy(text) {
  const textarea = document.createElement('textarea');
  textarea.value = text;
  textarea.style.position = 'fixed';
  textarea.style.opacity = '0';
  document.body.appendChild(textarea);
  textarea.select();
  try {
    document.execCommand('copy');
    showLocationIndicator('Koordinatlar kopyalandÄ±! âœ…');
    setTimeout(hideLocationIndicator, 2000);
  } catch (err) {
    showLocationIndicator('Kopyalama baÅŸarÄ±sÄ±z', true);
    setTimeout(hideLocationIndicator, 2000);
  }
  document.body.removeChild(textarea);
}

function shareCoordinates(coords) {
  const shareText = `ğŸ“ Konumum: ${coords}\nğŸ—ºï¸ Google Maps: https://www.google.com/maps?q=${coords}`;
  
  if (navigator.share) {
    navigator.share({
      title: 'Konum Bilgisi',
      text: shareText
    }).then(() => {
      showLocationIndicator('PaylaÅŸÄ±ldÄ±! âœ…');
      setTimeout(hideLocationIndicator, 2000);
    }).catch((err) => {
      if (err.name !== 'AbortError') {
        fallbackShare(shareText);
      }
    });
  } else {
    fallbackShare(shareText);
  }
}

function fallbackShare(text) {
  // SMS ile paylaÅŸma seÃ§eneÄŸi
  const smsLink = `sms:?body=${encodeURIComponent(text)}`;
  window.location.href = smsLink;
}

// Animasyon stilleri
const locationStyle = document.createElement('style');
locationStyle.textContent = `
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  @keyframes fadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
  }
  
  @keyframes scaleIn {
    from {
      opacity: 0;
      transform: scale(0.8);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }
`;
document.head.appendChild(locationStyle);

// ===== ACÄ°L DURUM Ã‡EVÄ°RÄ° SÄ°STEMÄ° =====
const translationData = {
  categories: [
    {
      id: 'pain',
      icon: 'ğŸ¤•',
      name: 'AÄŸrÄ± ve Åikayetler',
      phrases: [
        { tr: 'Nerede aÄŸrÄ±nÄ±z var?', en: 'Where is your pain?', ar: 'Ø£ÙŠÙ† Ø£Ù„Ù…ÙƒØŸ', de: 'Wo haben Sie Schmerzen?' },
        { tr: 'Ne zaman baÅŸladÄ±?', en: 'When did it start?', ar: 'Ù…ØªÙ‰ Ø¨Ø¯Ø£ØŸ', de: 'Wann hat es angefangen?' },
        { tr: 'AÄŸrÄ± ÅŸiddeti 1-10 arasÄ±?', en: 'Pain level 1-10?', ar: 'Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ù„Ù… Ù…Ù† 1-10ØŸ', de: 'SchmerzstÃ¤rke 1-10?' },
        { tr: 'GÃ¶ÄŸÃ¼s aÄŸrÄ±nÄ±z var mÄ±?', en: 'Do you have chest pain?', ar: 'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø£Ù„Ù… ÙÙŠ Ø§Ù„ØµØ¯Ø±ØŸ', de: 'Haben Sie Brustschmerzen?' },
        { tr: 'Nefes almakta zorlanÄ±yor musunuz?', en: 'Do you have difficulty breathing?', ar: 'Ù‡Ù„ ØªÙˆØ§Ø¬Ù‡ ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§Ù„ØªÙ†ÙØ³ØŸ', de: 'Haben Sie Atembeschwerden?' },
        { tr: 'BaÅŸ aÄŸrÄ±nÄ±z var mÄ±?', en: 'Do you have a headache?', ar: 'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ ØµØ¯Ø§Ø¹ØŸ', de: 'Haben Sie Kopfschmerzen?' },
        { tr: 'KarÄ±n aÄŸrÄ±nÄ±z var mÄ±?', en: 'Do you have abdominal pain?', ar: 'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø£Ù„Ù… ÙÙŠ Ø§Ù„Ø¨Ø·Ù†ØŸ', de: 'Haben Sie Bauchschmerzen?' }
      ]
    },
    {
      id: 'medical',
      icon: 'ğŸ’Š',
      name: 'TÄ±bbi GeÃ§miÅŸ',
      phrases: [
        { tr: 'Alerjiniz var mÄ±?', en: 'Do you have allergies?', ar: 'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø³ÙŠØ©ØŸ', de: 'Haben Sie Allergien?' },
        { tr: 'Hangi ilaÃ§larÄ± kullanÄ±yorsunuz?', en: 'What medications do you take?', ar: 'Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„ØªÙŠ ØªØªÙ†Ø§ÙˆÙ„Ù‡Ø§ØŸ', de: 'Welche Medikamente nehmen Sie?' },
        { tr: 'Kronik hastalÄ±ÄŸÄ±nÄ±z var mÄ±?', en: 'Do you have chronic diseases?', ar: 'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø£Ù…Ø±Ø§Ø¶ Ù…Ø²Ù…Ù†Ø©ØŸ', de: 'Haben Sie chronische Krankheiten?' },
        { tr: 'Daha Ã¶nce ameliyat oldunuz mu?', en: 'Have you had surgery before?', ar: 'Ù‡Ù„ Ø£Ø¬Ø±ÙŠØª Ø¹Ù…Ù„ÙŠØ© Ø¬Ø±Ø§Ø­ÙŠØ© Ù…Ù† Ù‚Ù‚Ø¨Ù„ØŸ', de: 'Wurden Sie schon operiert?' },
        { tr: 'Kalp hastalÄ±ÄŸÄ±nÄ±z var mÄ±?', en: 'Do you have heart disease?', ar: 'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ù…Ø±Ø¶ Ù‚Ù„Ø¨ÙŠØŸ', de: 'Haben Sie eine Herzerkrankung?' },
        { tr: 'Åeker hastalÄ±ÄŸÄ±nÄ±z var mÄ±?', en: 'Do you have diabetes?', ar: 'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ù…Ø±Ø¶ Ø§Ù„Ø³ÙƒØ±ÙŠØŸ', de: 'Haben Sie Diabetes?' },
        { tr: 'Tansiyon hastasÄ± mÄ±sÄ±nÄ±z?', en: 'Do you have high blood pressure?', ar: 'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø¶ØºØ· Ø¯Ù… Ù…Ø±ØªÙØ¹ØŸ', de: 'Haben Sie Bluthochdruck?' }
      ]
    },
    {
      id: 'emergency',
      icon: 'ğŸš¨',
      name: 'Acil Durum',
      phrases: [
        { tr: 'Sakin olun, size yardÄ±m edeceÄŸiz', en: 'Stay calm, we will help you', ar: 'Ø§Ø¨Ù‚ Ù‡Ø§Ø¯Ø¦Ø§Ù‹ØŒ Ø³Ù†Ø³Ø§Ø¹Ø¯Ùƒ', de: 'Bleiben Sie ruhig, wir helfen Ihnen' },
        { tr: 'Ambulans yolda', en: 'Ambulance is on the way', ar: 'Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø¥Ø³Ø¹Ø§Ù ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚', de: 'Krankenwagen ist unterwegs' },
        { tr: 'Hastaneye gidiyoruz', en: 'We are going to the hospital', ar: 'Ù†Ø­Ù† Ø°Ø§Ù‡Ø¨ÙˆÙ† Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰', de: 'Wir fahren ins Krankenhaus' },
        { tr: 'Hareket etmeyin', en: 'Do not move', ar: 'Ù„Ø§ ØªØªØ­Ø±Ùƒ', de: 'Bewegen Sie sich nicht' },
        { tr: 'Derin nefes alÄ±n', en: 'Take a deep breath', ar: 'Ø®Ø° Ù†ÙØ³Ø§Ù‹ Ø¹Ù…ÙŠÙ‚Ø§Ù‹', de: 'Atmen Sie tief ein' },
        { tr: 'Ailenizi arayalÄ±m mÄ±?', en: 'Should we call your family?', ar: 'Ù‡Ù„ Ù†ØªØµÙ„ Ø¨Ø¹Ø§Ø¦Ù„ØªÙƒØŸ', de: 'Sollen wir Ihre Familie anrufen?' },
        { tr: 'Kimlik belgeniz var mÄ±?', en: 'Do you have ID?', ar: 'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø¨Ø·Ø§Ù‚Ø© Ù‡ÙˆÙŠØ©ØŸ', de: 'Haben Sie einen Ausweis?' }
      ]
    },
    {
      id: 'pregnancy',
      icon: 'ğŸ¤°',
      name: 'KadÄ±n SaÄŸlÄ±ÄŸÄ±',
      phrases: [
        { tr: 'Hamile misiniz?', en: 'Are you pregnant?', ar: 'Ù‡Ù„ Ø£Ù†Øª Ø­Ø§Ù…Ù„ØŸ', de: 'Sind Sie schwanger?' },
        { tr: 'KaÃ§ aylÄ±k hamilesiniz?', en: 'How many months pregnant?', ar: 'ÙƒÙ… Ø´Ù‡Ø±Ø§Ù‹ Ù…Ù† Ø§Ù„Ø­Ù…Ù„ØŸ', de: 'In welchem Monat sind Sie schwanger?' },
        { tr: 'Kanama var mÄ±?', en: 'Is there bleeding?', ar: 'Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ù†Ø²ÙŠÙØŸ', de: 'Gibt es Blutungen?' },
        { tr: 'SancÄ±larÄ±nÄ±z var mÄ±?', en: 'Do you have contractions?', ar: 'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ ØªÙ‚Ù„ØµØ§ØªØŸ', de: 'Haben Sie Wehen?' },
        { tr: 'DoÄŸum tarihiniz ne zaman?', en: 'When is your due date?', ar: 'Ù…ØªÙ‰ Ù…ÙˆØ¹Ø¯ ÙˆÙ„Ø§Ø¯ØªÙƒØŸ', de: 'Wann ist Ihr Geburtstermin?' }
      ]
    },
    {
      id: 'trauma',
      icon: 'ğŸ©¹',
      name: 'Travma',
      phrases: [
        { tr: 'Kaza mÄ± geÃ§irdiniz?', en: 'Did you have an accident?', ar: 'Ù‡Ù„ ØªØ¹Ø±Ø¶Øª Ù„Ø­Ø§Ø¯Ø«ØŸ', de: 'Hatten Sie einen Unfall?' },
        { tr: 'DÃ¼ÅŸtÃ¼nÃ¼z mÃ¼?', en: 'Did you fall?', ar: 'Ù‡Ù„ Ø³Ù‚Ø·ØªØŸ', de: 'Sind Sie gestÃ¼rzt?' },
        { tr: 'BaÅŸÄ±nÄ±zÄ± mÄ± vurdunuz?', en: 'Did you hit your head?', ar: 'Ù‡Ù„ Ø¶Ø±Ø¨Øª Ø±Ø£Ø³ÙƒØŸ', de: 'Haben Sie Ihren Kopf gestoÃŸen?' },
        { tr: 'Bilincinizi kaybettiniz mi?', en: 'Did you lose consciousness?', ar: 'Ù‡Ù„ ÙÙ‚Ø¯Øª ÙˆØ¹ÙŠÙƒØŸ', de: 'Haben Sie das Bewusstsein verloren?' },
        { tr: 'KÄ±rÄ±k olabilir, hareket etmeyin', en: 'May be broken, do not move', ar: 'Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù…ÙƒØ³ÙˆØ±Ø§Ù‹ØŒ Ù„Ø§ ØªØªØ­Ø±Ùƒ', de: 'KÃ¶nnte gebrochen sein, nicht bewegen' }
      ]
    },
    {
      id: 'consent',
      icon: 'âœ…',
      name: 'Onay ve Bilgilendirme',
      phrases: [
        { tr: 'Tedaviyi kabul ediyor musunuz?', en: 'Do you consent to treatment?', ar: 'Ù‡Ù„ ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù„Ø§Ø¬ØŸ', de: 'Stimmen Sie der Behandlung zu?' },
        { tr: 'Ä°ÄŸne yapacaÄŸÄ±z', en: 'We will give you an injection', ar: 'Ø³Ù†Ø¹Ø·ÙŠÙƒ Ø­Ù‚Ù†Ø©', de: 'Wir geben Ihnen eine Spritze' },
        { tr: 'Serum takacaÄŸÄ±z', en: 'We will start an IV', ar: 'Ø³Ù†Ø¨Ø¯Ø£ Ø¨Ø§Ù„Ù…Ø­Ù„ÙˆÙ„ Ø§Ù„ÙˆØ±ÙŠØ¯ÙŠ', de: 'Wir legen einen Zugang' },
        { tr: 'Oksijen vereceÄŸiz', en: 'We will give you oxygen', ar: 'Ø³Ù†Ø¹Ø·ÙŠÙƒ Ø§Ù„Ø£ÙƒØ³Ø¬ÙŠÙ†', de: 'Wir geben Ihnen Sauerstoff' },
        { tr: 'Kan tahlili yapacaÄŸÄ±z', en: 'We will do a blood test', ar: 'Ø³Ù†Ø¬Ø±ÙŠ ÙØ­Øµ Ø¯Ù…', de: 'Wir machen eine Blutuntersuchung' }
      ]
    }
  ]
};

let currentLanguage = 'en';
let speechSynthesis = window.speechSynthesis;

function openTranslator() {
  showTranslatorModal();
}

function showTranslatorModal() {
  let modal = document.getElementById('translatorModal');
  
  if (!modal) {
    modal = document.createElement('div');
    modal.id = 'translatorModal';
    modal.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      z-index: 10002;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s ease;
      overflow-y: auto;
      padding: 20px;
    `;
    
    // BoÅŸluÄŸa tÄ±klayÄ±nca kapat
    modal.addEventListener('click', function(e) {
      if (e.target === modal) {
        closeTranslatorModal();
      }
    });
    
    document.body.appendChild(modal);
  }
  
  modal.innerHTML = `
    <div onclick="event.stopPropagation()" style="background: var(--card-bg); padding: 25px; border-radius: 20px; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.5); animation: scaleIn 0.3s ease;">
      
      <!-- Header -->
      <div style="text-align: center; margin-bottom: 25px;">
        <div style="font-size: 50px; margin-bottom: 10px;">ğŸŒ</div>
        <h2 style="margin: 0 0 8px 0; color: var(--primary-1);">Acil Durum Ã‡evirisi</h2>
        <p style="color: var(--muted); margin: 0; font-size: 13px;">Offline Ã§alÄ±ÅŸÄ±r â€¢ Sesli okuma</p>
      </div>
      
      <!-- Language Selector -->
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 25px;">
        <button onclick="selectLanguage('en')" id="lang-en" style="padding: 12px; background: var(--primary-1); color: white; border: none; border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 5px;">
          <span style="font-size: 24px;">ğŸ‡¬ğŸ‡§</span>
          <span>English</span>
        </button>
        <button onclick="selectLanguage('ar')" id="lang-ar" style="padding: 12px; background: var(--input-bg); color: var(--text); border: 2px solid var(--muted); border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 5px;">
          <span style="font-size: 24px;">ğŸ‡¸ğŸ‡¦</span>
          <span>Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
        </button>
        <button onclick="selectLanguage('de')" id="lang-de" style="padding: 12px; background: var(--input-bg); color: var(--text); border: 2px solid var(--muted); border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 5px;">
          <span style="font-size: 24px;">ğŸ‡©ğŸ‡ª</span>
          <span>Deutsch</span>
        </button>
      </div>
      
      <!-- Categories -->
      <div id="translatorContent"></div>
      
      <!-- Close Button -->
      <button onclick="closeTranslatorModal()" style="width: 100%; padding: 14px; background: var(--input-bg); color: var(--text); border: 1px solid var(--muted); border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; margin-top: 20px;">
        Kapat
      </button>
      
    </div>
  `;
  
  modal.style.display = 'flex';
  renderTranslations();
}

function selectLanguage(lang) {
  currentLanguage = lang;
  
  // Buton stillerini gÃ¼ncelle
  ['en', 'ar', 'de'].forEach(l => {
    const btn = document.getElementById(`lang-${l}`);
    if (btn) {
      if (l === lang) {
        btn.style.background = 'var(--primary-1)';
        btn.style.color = 'white';
        btn.style.border = 'none';
      } else {
        btn.style.background = 'var(--input-bg)';
        btn.style.color = 'var(--text)';
        btn.style.border = '2px solid var(--muted)';
      }
    }
  });
  
  renderTranslations();
}

function renderTranslations() {
  const content = document.getElementById('translatorContent');
  if (!content) return;
  
  let html = '';
  
  translationData.categories.forEach(category => {
    html += `
      <div style="margin-bottom: 20px;">
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px; padding: 10px; background: var(--input-bg); border-radius: 10px;">
          <span style="font-size: 24px;">${category.icon}</span>
          <span style="font-weight: 700; color: var(--text); font-size: 15px;">${category.name}</span>
        </div>
        <div style="display: flex; flex-direction: column; gap: 8px;">
    `;
    
    category.phrases.forEach((phrase, index) => {
      const translatedText = phrase[currentLanguage];
      const categoryId = category.id;
      const phraseId = `${categoryId}-${index}`;
      
      html += `
        <div style="background: var(--input-bg); padding: 12px 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid transparent; transition: all 0.2s ease;" onmouseover="this.style.borderColor='var(--primary-1)'" onmouseout="this.style.borderColor='transparent'">
          <div style="flex: 1;">
            <div style="font-size: 13px; color: var(--muted); margin-bottom: 4px;">${phrase.tr}</div>
            <div style="font-size: 16px; font-weight: 600; color: var(--text); ${currentLanguage === 'ar' ? 'direction: rtl; text-align: right;' : ''}">${translatedText}</div>
          </div>
          <button onclick="speakPhrase('${translatedText}', '${currentLanguage}')" style="background: var(--primary-1); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-left: 10px;">
            ğŸ”Š
          </button>
        </div>
      `;
    });
    
    html += `
        </div>
      </div>
    `;
  });
  
  content.innerHTML = html;
}

function speakPhrase(text, lang) {
  if (!speechSynthesis) {
    alert('TarayÄ±cÄ±nÄ±z sesli okuma Ã¶zelliÄŸini desteklemiyor.');
    return;
  }
  
  // Ã–nceki konuÅŸmayÄ± durdur
  speechSynthesis.cancel();
  
  // KÄ±sa bir gecikme ekle (bazÄ± tarayÄ±cÄ±larda gerekli)
  setTimeout(() => {
    const utterance = new SpeechSynthesisUtterance(text);
    
    // Dil kodlarÄ±nÄ± ayarla
    const langCodes = {
      'en': 'en-US',
      'ar': 'ar-SA',
      'de': 'de-DE'
    };
    
    utterance.lang = langCodes[lang] || 'en-US';
    
    // Daha iyi ses kalitesi iÃ§in ayarlar
    utterance.rate = 0.85; // Daha yavaÅŸ ve anlaÅŸÄ±lÄ±r
    utterance.pitch = 1.0; // Normal ton
    utterance.volume = 1.0; // Maksimum ses
    
    // Mevcut sesleri al ve en iyisini seÃ§
    const voices = speechSynthesis.getVoices();
    
    if (voices.length > 0) {
      let selectedVoice = null;
      
      // Dile gÃ¶re en iyi sesi seÃ§
      if (lang === 'en') {
        // Ä°ngilizce iÃ§in kaliteli ses ara
        selectedVoice = voices.find(voice => 
          (voice.lang === 'en-US' || voice.lang === 'en-GB') && 
          (voice.name.includes('Google') || voice.name.includes('Microsoft') || voice.name.includes('Enhanced'))
        ) || voices.find(voice => voice.lang.startsWith('en'));
      } else if (lang === 'ar') {
        // ArapÃ§a iÃ§in Ã¶zel ses ara
        selectedVoice = voices.find(voice => 
          voice.lang.startsWith('ar') && 
          (voice.name.includes('Google') || voice.name.includes('Microsoft'))
        ) || voices.find(voice => voice.lang.startsWith('ar'));
        
        // ArapÃ§a iÃ§in daha yavaÅŸ konuÅŸ
        utterance.rate = 0.75;
      } else if (lang === 'de') {
        // Almanca iÃ§in kaliteli ses ara
        selectedVoice = voices.find(voice => 
          voice.lang === 'de-DE' && 
          (voice.name.includes('Google') || voice.name.includes('Microsoft') || voice.name.includes('Enhanced'))
        ) || voices.find(voice => voice.lang.startsWith('de'));
      }
      
      if (selectedVoice) {
        utterance.voice = selectedVoice;
        console.log('SeÃ§ilen ses:', selectedVoice.name, selectedVoice.lang);
      } else {
        console.warn('Uygun ses bulunamadÄ±, varsayÄ±lan ses kullanÄ±lÄ±yor');
      }
    }
    
    // GÃ¶rsel geri bildirim
    showTranslatorIndicator('ğŸ”Š Okunuyor...');
    
    utterance.onstart = function() {
      console.log('Sesli okuma baÅŸladÄ±:', text);
    };
    
    utterance.onend = function() {
      console.log('Sesli okuma bitti');
      hideTranslatorIndicator();
    };
    
    utterance.onerror = function(event) {
      console.error('Sesli okuma hatasÄ±:', event.error);
      hideTranslatorIndicator();
      
      let errorMsg = 'Sesli okuma hatasÄ±';
      if (event.error === 'not-allowed') {
        errorMsg = 'Sesli okuma izni gerekli';
      } else if (event.error === 'network') {
        errorMsg = 'Ä°nternet baÄŸlantÄ±sÄ± gerekli';
      } else if (lang === 'ar') {
        errorMsg = 'ArapÃ§a ses desteÄŸi yok. Cihaz ayarlarÄ±ndan ArapÃ§a dil paketi indirin.';
      }
      
      showTranslatorIndicator(errorMsg, true);
      setTimeout(hideTranslatorIndicator, 3000);
    };
    
    // KonuÅŸmayÄ± baÅŸlat
    speechSynthesis.speak(utterance);
  }, 100);
}

// Sesleri yÃ¼kle (sayfa yÃ¼klendiÄŸinde)
if (speechSynthesis) {
  // Seslerin yÃ¼klenmesini bekle
  speechSynthesis.onvoiceschanged = function() {
    const voices = speechSynthesis.getVoices();
    console.log('Mevcut sesler:', voices.length);
    voices.forEach(voice => {
      console.log(`- ${voice.name} (${voice.lang})`);
    });
  };
  
  // Ä°lk yÃ¼kleme
  speechSynthesis.getVoices();
}

function closeTranslatorModal() {
  const modal = document.getElementById('translatorModal');
  if (modal) {
    speechSynthesis.cancel(); // KonuÅŸmayÄ± durdur
    modal.style.animation = 'fadeOut 0.3s ease';
    setTimeout(() => {
      modal.style.display = 'none';
    }, 300);
  }
}

function showTranslatorIndicator(message, isError = false) {
  let indicator = document.getElementById('translatorIndicator');
  
  if (!indicator) {
    indicator = document.createElement('div');
    indicator.id = 'translatorIndicator';
    indicator.style.cssText = `
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: ${isError ? 'rgba(220, 38, 38, 0.95)' : 'rgba(59, 130, 246, 0.95)'};
      color: white;
      padding: 12px 24px;
      border-radius: 50px;
      font-size: 14px;
      font-weight: 600;
      z-index: 10003;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      backdrop-filter: blur(10px);
      animation: slideDown 0.3s ease;
    `;
    document.body.appendChild(indicator);
  }
  
  indicator.textContent = message;
  indicator.style.background = isError ? 'rgba(220, 38, 38, 0.95)' : 'rgba(59, 130, 246, 0.95)';
  indicator.style.display = 'block';
}

function hideTranslatorIndicator() {
  const indicator = document.getElementById('translatorIndicator');
  if (indicator) {
    indicator.style.animation = 'slideUp 0.3s ease';
    setTimeout(() => {
      indicator.style.display = 'none';
    }, 300);
  }
}
</script>

</body>
</html>
